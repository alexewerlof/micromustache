<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Micromustache Playground</title>
    <style>
        body, html {
            margin: 0;
            padding: 0.5em;
            font-family: 'Courier New', Courier, monospace;
            color: white;
            background-color: rgb(122, 112, 112);
        }
        textarea {
            display: block;
            border: 0.3em solid transparent;
            background-color: rgb(195, 195, 195);
            color: black;
            box-sizing: border-box;
            resize: vertical;
            width: 100%;   
            height: 30vh;
            padding: 1em;
        }
        textarea:hover {
            background-color: rgb(231, 231, 231);
        }
        textarea:focus {
            background-color: white;
            outline: none;
        }
        textarea.error {
            border-color: rgb(253, 153, 153);
        }
        .error {
            background-color: rgb(253, 153, 153);
        }
        label {
            font-size: 1.2em;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <label for="template">Template</label>
    <textarea id="template">Hello {{name}}!</textarea>
    <div id="template-error" class="error"></div>
    <label for="scope">Scope</label>
    <textarea id="scope">{
    "name": "Michael Jackson"
}</textarea>
    <div id="scope-error" class="error"></div>
    <label>Result</label>
    <div id="result"></div>
    <script src="../dist/micromustache.umd.js"></script>
    <script>
        const template = document.getElementById('template')
        const templateError = document.getElementById('template-error')
        const scope = document.getElementById('scope')
        const scopeError = document.getElementById('scope-error')
        const result = document.getElementById('result')
        scope.addEventListener('keyup', render)
        template.addEventListener('keyup', render)
        function render() {
            let renderer
            try {
                renderer = micromustache.compile(template.value, { validateVarNames: true })
                template.classList.remove('error')
                templateError.innerText = ''
            } catch (err) {
                template.classList.toggle('error', true)
                templateError.innerText = err
            }
            let scopeObj
            try {
                scopeObj = JSON.parse(scope.value)
                scope.classList.remove('error')
                scopeError.innerText = ''
            } catch (err) {
                scope.classList.toggle('error', true)
                scopeError.innerText = err
            }
            if (!renderer || !scopeObj) {
                result.innerText = ''
                return
            }
            try {
                result.innerText = renderer.render(template.value, scopeObj)
                result.classList.remove('error')
            } catch (err) {
                result.innerText = err
                result.classList.toggle('error', true)
            }
        }
        render()
    </script>
</body>
</html>