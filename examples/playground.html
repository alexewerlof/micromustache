<!DOCTYPE html>
<html lang="en">
    <!-- A super simple and stupid JQuery-slide playground to try micromustache -->
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Micromustache Playground</title>
    <style>
        body, html {
            background-color: #5f6875;
            color: #dfeaf1;
            font-family: 'Courier New', Courier, monospace;
            margin: 0;
            padding: 0.5em;
        }
        aside {
            position: fixed;
            left: 0;
            top: 0;
            bottom: 0;
            background-color: #586579;
            box-shadow: 0 0 1em black;
            padding: 1em;
            z-index: 1;
        }
        .io {
            background-color: #c3c3c3;
            border: 0.3em solid transparent;
            box-sizing: border-box;
            color: black;
            display: block;
            font-family: inherit;
            font-size: inherit;
            padding: 1em;
            width: 100%;
        }
        .entry:hover {
            background-color: #d6d6d6;
        }
        .entry:focus {
            background-color: white;
            outline: none;
        }
        textarea {
            resize: vertical;
            height: 15vh;
        }
        textarea.error {
            border-color: #ffbdbd;
        }
        .error {
            background-color: #ffbdbd;
            color: red;
        }
        h1, h2, h3 {
            font-family: Tahoma, Geneva, sans-serif;
            font-weight: lighter;
        }
        h1 {
            font-size: 2em;
        }
        h2 {
            font-size: 1.5em;
        }
        h3 {
            font-size: 1.2em;
        }
        a {
            color: inherit;
        }
        footer ul {
            padding: 0;
        }
        footer li {
            display: inline;
        }
        footer li + li::before {
            content: '| ';
        }
    </style>
</head>
<body>
    <h2 id="options-toggle">⚙ Options</h2>
    <div id="aside-visible-overlay"></div>
    <aside>
        <label for="example-selector"><h2>Examples</h2></label>
        <select id="example-selector" class="io entry"></select>
        <hr/>
        <label><input type="checkbox"/>Props Exist</label>
        <br/>
        <label><input type="checkbox"/>Explicit</label>
        <br/>
        <label><input type="checkbox"/>Validate Var Names</label>
        <br/>
        <label><h3>Depth</h3><input class="io entry" type="number" min="0" max="20" value="5"/></label>
        <label><h3>Max var name length</h3><input class="io entry" type="number" min="0" max="20" value="5"/></label>
        <label>
            <h3>Open tag</h3>
            <input class="io entry" type="text" value="{{"/>
        </label>
        <label>
            <h3>Close tag</h3>
            <input class="io entry" type="text" value="}}"/>
        </label>
    </aside>
    <div style="position: absolute;top: 0;bottom: 0;left: 0;right: 0;backdrop-filter: blur(3px);"></div>
    <main>
        <header>
            <h1>Micromustache Playground</h1>
        </header>
        <label for="template"><h2>Template</h2></label>
        <textarea id="template" class="io entry"></textarea>
        <div id="template-error" class="error"></div>
        <label for="scope"><h2>Scope</h2></label>
        <textarea id="scope" class="io entry"></textarea>
        <div id="scope-error" class="error"></div>

        <label><h2>Result</h2></label>
        <div id="result" class="io"></div>
        <div id="result-error" class="error"></div>
        <footer>
            <ul>
                <li><a href="https://github.com/userpixel/micromustache">Github</a></li>
                <li><a href="https://www.npmjs.com/package/micromustache">NPM</a></li>
                <li><a href="https://userpixel.github.io/micromustache/">API</a></li>
                <li><a href="https://github.com/userpixel/micromustache/wiki/FAQ">FAQ</a></li>
                <li><a href="https://github.com/userpixel/micromustache/wiki/Known-issues">Known Issues</a></li>
                <li><a href="https://twitter.com/alexewerlof">Twitter</a></li>
            </ul>
        </footer>
    </main>
    <script src="../dist/micromustache.umd.js"></script>
    <script>
        const examples = [
            {
                name: 'Simple',
                template: 'Hello {{name}}!',
                scope: {
                    name: 'Alex'
                }
            },{
                name: 'Array',
                template: 'I like {{0}}, {{4}} and {{[2]}} out of {{length}} fruits!',
                scope: ['Apple', 'Orange', 'Banana', 'Citrun', 'Tomato']
            },
            {
                name: 'Nested',
                template: '{{person.name}}\'s mobile nr is: {{person.contacts.tel[1].nr}}!',
                scope: {
                    person: {
                        name: 'Alex',
                        contacts: {
                            address: 'Stockholm, Sweden',
                            tel: [
                                {
                                    nr: '+4600000000'
                                },
                                {
                                    nr: '+4611111111'
                                }
                            ]
                        }
                    }
                }
            }
        ]

        const getEl = id => document.getElementById(id)
        const createEl = tagName => document.createElement(tagName)
        const text = (el, contents) => el.innerText = contents
        const getVal = (el) => el.value
        const setVal = (el, value) => el.value = value
        const on = (el, eventName, handler) => el.addEventListener(eventName, handler)
        const fire = (el, eventName) => el.dispatchEvent(new Event(eventName ))
        const ready = fn => ['complete', 'interactive'].includes(document.readyState) ? fn() : on(document, 'DOMContentLoaded', fn)

        const exampleSelector = getEl('example-selector')
        const template = getEl('template')
        const optionsToggle = getEl('options-toggle')
        const templateError = getEl('template-error')
        const scope = getEl('scope')
        const scopeError = getEl('scope-error')
        const result = getEl('result')
        const resultError = getEl('result-error')

        function runFn(successEl, errorEl, fn) {
            try {
                const result = fn()
                successEl.classList.remove('error')
                text(errorEl, '')
                return result
            } catch (err) {
                successEl.classList.add('error')
                text(errorEl, '⛔ ' + err)
            }
        }

        function render() {
            // Handle the template errors
            const renderer = runFn(
                template,
                templateError,
                () => micromustache.compile(getVal(template), { validateVarNames: true })
            )
            // Handle the scope errors
            const scopeObj = runFn(scope, scopeError, () => JSON.parse(getVal(scope)))

            if (!renderer || !scopeObj) {
                return text(result, '')
            }

            // If all is well try to generate the results handling the errors
            text(result, runFn(result, resultError, () => renderer.render(scopeObj)))
        }

        ready(() => {
            examples.forEach((example, i) => {
                const option = createEl('option')
                text(option, example.name)
                setVal(option, i)
                exampleSelector.appendChild(option)
            })
            on(optionsToggle, 'click', () => {
                const contents = optionsToggle.nextElementSibling
                contents.hidden = !contents.hidden
            })
            on(scope, 'keyup', render)
            on(template, 'keyup', render)
            on(exampleSelector, 'change', () => {
                const example = examples[getVal(exampleSelector)]
                setVal(template, example.template)
                setVal(scope, JSON.stringify(example.scope, null, 2))
                render()
            })
            fire(exampleSelector, 'change')
        })
    </script>
</body>
</html>